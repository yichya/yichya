---
layout: post
title: 大型网站架构设计实践（1）前言
---

正式参加 Extalk 项目后端工作到现在已经有一个月了。这一个月学习的网站架构相关的知识确实足够多，可能我要用几年的实践才能完全消化。

在此先推荐一本书：《大型网站技术架构：核心原理与案例分析》。其中介绍了很多适合实践应用的方法。

这一系列的坑可能需要数月填完。我将按照下面的顺序进行分别介绍。

1. 应用结构分层
2. 业务服务器的负载均衡和高可用性切换
3. 数据库的高性能与高可用性结构
4. 缓存数据库的综合应用
5. 日志与监控系统设计
6. 数据库的横向与纵向拆分
7. 业务逻辑中的性能优化
8. 系统的安全性相关设计
9. 后记

<!-- more -->

## 应用结构分层

将应用进行分层，可以降低整个系统的耦合度，同时也便于新代码的热部署。

本项目分为两个部分，第一部分由 Node.js 完成，负责认证 Token、负载均衡等工作；第二部分为核心业务逻辑部分，由 Python 完成，使用了 Tornado Web 框架，搭配 SQLAlchemy ORM 数据库访问层。

## 业务服务器的负载均衡和高可用性切换

本项目的第一层实现了将访问请求平均分配到数个部署了第二部分的应用服务器上的功能。

同时，为了保证可用性，第一部分还包含了检查第二部分服务器是否正常工作的功能，并能实现动态更新可用服务器列表、保证服务可用性的功能。

## 数据库的高性能与高可用性结构

为了降低单一数据库实例的负载，我们一般会使用两种方案：在业务逻辑上进行拆分，或者将所有请求分配到多个服务器中。

为了保证应用可用性，在某一数据库实例因意外无法访问时，系统需要 Plan B 即能够快速热切换到热备份服务器。

这里我们将介绍常见的数据库高性能与高可用部署方案，包括主从同步实现读写分离、双主循环降低写入服务器压力、多服务器实例实现热备份等。

本项目在第一版设计中包含了读写分离的支持，不过并未启用。

## 缓存数据库的综合应用

应用内存缓存数据库可以极大提高请求响应速度并降低数据库压力。同时，Redis 提供的 ttl 功能也为 Session 提供了十分优雅的解决方案。

这里我们介绍用 Redis 存储用户 Token、dogpile.cache 搭配 Memcached 进行数据库访问缓存等功能。 

## 日志与监控系统设计

通过日志记录访问量最大的 API、访问量最多的数据，可以对整个系统的运行条件有更直观的认识，为后期的迭代指明方向。

同时，服务器的运行状态需要能够实时监控，以保证系统的可用性。

本项目在第一部分中设计了简单的应用服务器状态监控、API 调用日志等功能。第二部分会定时进行健康度自检，并将数据传递到第一层。

## 数据库的横向与纵向拆分

Sharding 可以提高系统的可用性、降低数据库访问压力、更轻松的实现数据库扩容。Sharding 是整个系统伸缩性的核心部分。

本项目初期并未采用 Sharding 设计，不过 SQLAlchemy 提供了原生支持，我们可以较为轻松的开启这一功能。

## 业务逻辑中的性能优化

这里我们将介绍开发中遇到的一系列性能优化相关的难题和采用的解决方案。

## 系统的安全性相关设计

这里我们会介绍包括 CSRF、XSS、SQL 防注入等常见的安全防护策略。

本项目在第一部分实现了 XSS 安全防护，在第二部分利用 SQLAlchemy ORM 实现数据库防注入安全保护。

## 后记

这里随便扯点儿啥，可能跟技术就不是很相关了。


